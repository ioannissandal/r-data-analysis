---
title: "Loan_Data"
author: "Ioannis Sandalidis"
date: "2025-04-01"
output:
  html_document:
    df_print: paged
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r,echo=FALSE}
library(dplyr)
library(ggplot2)

# Φόρτωση του dataset
loandata <- read.csv("C:/Users/giann/Documents/loan_data (1).csv")
```

## Περιγραφή του Dataset:

Το dataset περιέχει δημογραφικά, οικονομικά και πιστωτικά στοιχεία για άτομα που έχουν αιτηθεί δάνειο. <https://www.kaggle.com/datasets/udaymalviya/bank-loan-data>.

<br>
<br>

### Αιτιολόγηση της Επιλογής για Επιχειρηματική Αναλυτική:
Το συγκεκριμένο dataset είναι εξαιρετικά χρήσιμο για την επιχειρηματική αναλυτική καθώς επιτρέπει:

1) Αξιολόγηση πιστοληπτικής ικανότητας (credit scoring)

2) Πρόβλεψη πιθανότητας χρεοκοπίας ενός πελάτη

3) Βελτιστοποίηση επιτοκίων και όρων δανειοδότησης με βάση το ρίσκο

4) Διαχείριση ρίσκου και βελτίωση στρατηγικών ανάκτησης οφειλών

<br>


### Πιθανά Επιχειρηματικά Ερωτήματα:
Ποιοι παράγοντες επηρεάζουν περισσότερο την έγκριση ενός δανείου;

Υπάρχει συσχέτιση μεταξύ του επιτοκίου και του κινδύνου αθέτησης πληρωμών;

Ποιο δημογραφικό προφίλ δανειοληπτών έχει τη μεγαλύτερη πιθανότητα αποπληρωμής;

Υπάρχει διαφορά στη χορήγηση δανείων μεταξύ ατόμων με διαφορετικά επίπεδα εκπαίδευσης ή επαγγελματικής εμπειρίας;

<br>


### Περιγραφή Μεταβλητών:
- person_age: Ηλικία του ατόμου που αιτείται το δάνειο. Τύπος δεδομένων: αριθμητική (int/float). Εύρος τιμών: 18+ έτη.

- person_gender: Φύλο του ατόμου. Τύπος δεδομένων: κατηγορική (string). Δυνατές τιμές: "Male", "Female".

- person_education: Επίπεδο εκπαίδευσης του ατόμου. Τύπος δεδομένων: κατηγορική (string). Δυνατές τιμές: "High School", "Bachelor", "Master", κ.ά.

- person_income: Ετήσιο εισόδημα του ατόμου σε δολάρια. Τύπος δεδομένων: αριθμητική (float).

- person_emp_exp: Χρόνια επαγγελματικής εμπειρίας του ατόμου. Τύπος δεδομένων: αριθμητική (float). Εύρος τιμών: 0+ έτη.

- person_home_ownership: Κατάσταση ιδιοκτησίας κατοικίας. Τύπος δεδομένων: κατηγορική (string). Δυνατές τιμές: "RENT", "OWN", "MORTGAGE", κ.ά.

- loan_amnt: Ποσό του δανείου που αιτήθηκε το άτομο, σε δολάρια. Τύπος δεδομένων: αριθμητική (float).

- loan_intent: Σκοπός για τον οποίο λαμβάνεται το δάνειο. Τύπος δεδομένων: κατηγορική (string). Δυνατές τιμές: "PERSONAL", "EDUCATION", "MEDICAL", κ.ά.

- loan_int_rate: Επιτόκιο του δανείου σε ποσοστό (%). Τύπος δεδομένων: αριθμητική (float). Εύρος τιμών: 0-100%.

- loan_percent_income: Ποσοστό του ετήσιου εισοδήματος που διατίθεται για την αποπληρωμή του δανείου. Τύπος δεδομένων: αριθμητική (float). Εύρος τιμών: 0-1.

- cb_person_cred_hist_length: Μήκος του πιστωτικού ιστορικού του ατόμου, σε έτη. Τύπος δεδομένων: αριθμητική (int). Εύρος τιμών: 0+ έτη.

- credit_score: Πιστωτική βαθμολογία του ατόμου. Τύπος δεδομένων: αριθμητική (int). Τυπικό εύρος τιμών: 300-850.

- previous_loan_defaults_on_file: Υπάρχουν προηγούμενες αθετήσεις πληρωμών; Τύπος δεδομένων: κατηγορική (string). Δυνατές τιμές: "Yes", "No".

- loan_status: Κατάσταση αποπληρωμής του δανείου. Τύπος δεδομένων: δυαδική (0: Αθέτηση πληρωμής, 1: Κανονική αποπληρωμή).
<br>
<br>


## Περιγραφικά Στατιστικά

```{r}
summary(loandata)
```
<br>

## Scatter Plot

```{r}
library(ggplot2)
ggplot(loandata, aes(x = person_age, y = person_income)) + geom_point()
```
<br>
<br>

Παρατηρείται ότι το μεγαλύτερο μέρος των δεδομένων συγκεντρώνεται σε χαμηλές τιμές εισοδήματος.

Υπάρχουν ορισμένες ακραίες τιμές (outliers) ιδιαίτερα σε άτομα με εξαιρετικά υψηλό εισόδημα και μεγάλη ηλικία (>100 έτη), που ενδεχομένως να είναι σφάλματα ή εξαιρετικά σπάνιες περιπτώσεις.

<br>
<br>

## Scatter Plot 2

```{r}
library(ggplot2)
ggplot(loandata, aes(x = loan_amnt, y = person_education)) + geom_point()
```
<br>
<br>


Το ποσό δανείου κατανέμεται ομοιόμορφα μεταξύ των επιπέδων εκπαίδευσης.

Δεν φαίνεται ξεκάθαρη σχέση μεταξύ επιπέδου εκπαίδευσης και ποσού δανείου.

Πιθανώς απαιτείται διαφορετική απεικόνιση (π.χ. boxplot) για να διερευνηθεί καλύτερα η κατανομή των ποσών ανά κατηγορία.

<br>
<br>

## Box Plot

```{r}
ggplot(loandata, aes(x = loan_amnt, y = person_age, fill = "blue")) +
  geom_boxplot() +
  theme_minimal() +
  scale_fill_brewer(palette = "Set3")
```
<br>
<br>

Τα περισσότερα δεδομένα βρίσκονται κοντά στον πυθμένα του boxplot, υποδηλώνοντας ότι το μεγαλύτερο μέρος των δανείων αφορά άτομα σε χαμηλότερες ηλικίες.

Υπάρχουν σημαντικά outliers σε υψηλές ηλικίες, που ίσως χρειάζονται περαιτέρω ανάλυση.

Η διανομή του ποσού δανείου φαίνεται συγκεντρωμένη σε μια συγκεκριμένη περιοχή με λίγες εξαιρέσεις.

<br>
<br>

## Histogram

```{r}
ggplot(loandata, aes(loan_amnt)) +
      geom_histogram()
```

<br>
<br>

Τα περισσότερα δάνεια φαίνεται να είναι συγκεντρωμένα σε χαμηλότερα ποσά (κάτω από 15.000).
Υπάρχουν επίσης μερικές κορυφές (spikes), πιθανότατα λόγω συγκεκριμένων σταθερών ποσών δανείου που επιλέγονται συχνά.
Διασπορά και Συμμετρία
Το διάγραμμα δείχνει μια ασύμμετρη κατανομή, με ουρά προς τα δεξιά (δεξιά λοξότητα).
Αυτό σημαίνει ότι υπάρχουν μερικά δάνεια με πολύ υψηλά ποσά, αλλά είναι λιγότερο συχνά.
Ρυθμίσεις του Histogram
Η προεπιλεγμένη τιμή bins = 30 έχει χρησιμοποιηθεί για την ομαδοποίηση των δεδομένων.
Ενδέχεται να χρειαστεί προσαρμογή της παραμέτρου binwidth για πιο ομαλή παρουσίαση.

<br>
<br>

## Barchart

```{r}
ggplot(loandata, aes(loan_intent)) +
      geom_bar()
```

<br>
<br>

Εκπαίδευση (EDUCATION) και Ιατρικά Έξοδα (MEDICAL) είναι από τους πιο συχνούς σκοπούς δανείων.
Η κατηγορία HOMEIMPROVEMENT έχει το μικρότερο αριθμό δανείων, δηλώνοντας ότι λιγότεροι δανειολήπτες παίρνουν δάνειο για ανακαίνιση σπιτιού.
Οι υπόλοιπες κατηγορίες έχουν σχετικά ισοκατανεμημένο αριθμό δανείων, χωρίς μεγάλες διαφορές μεταξύ τους.
Συμπέρασμα
Το διάγραμμα μας βοηθά να κατανοήσουμε τις προτεραιότητες των δανειοληπτών. Παρατηρούμε ότι οι πιο συχνοί λόγοι λήψης δανείων σχετίζονται με εκπαίδευση και ιατρικά έξοδα, ενώ οι λιγότεροι δανειολήπτες επιλέγουν δάνεια για βελτίωση κατοικίας

<br>
<br>

## Γραμμική Παλινδρόμηση
### Model 1 - Ποσό δανείου

```{r}
model1 <- lm(person_age ~ loan_amnt, data = loandata)
summary(model1)
```

<br>
<br>

```{r}
ggplot(loandata, aes(x = loan_amnt, y = person_age)) +
  geom_point(alpha = 0.5) +
  geom_abline(intercept = coef(model1)[1], slope = coef(model1)[2], color = "red", linewidth = 1.2) +
  labs(title = "Γραμμική Παλινδρόμηση: Ηλικία ~ Ποσό Δανείου",
       x = "Loan Amount", y = "Person Age")
```

**Σχόλιο:**
Το διάγραμμα παρουσιάζει τη γραμμική παλινδρόμηση της ηλικίας σε σχέση με το ποσό δανείου. Από την κατανομή των σημείων φαίνεται ότι υπάρχει μεγάλη συγκέντρωση ατόμων με χαμηλά ποσά δανείων, κυρίως κάτω από τις 10.000 μονάδες, ενώ οι ηλικίες κυμαίνονται κυρίως μεταξύ 20 και 60 ετών. Η κόκκινη γραμμή παλινδρόμησης είναι σχεδόν οριζόντια, γεγονός που υποδηλώνει ότι δεν υπάρχει ουσιαστική γραμμική συσχέτιση μεταξύ της ηλικίας και του ποσού δανείου. Συνεπώς, μπορούμε να συμπεράνουμε πως η ηλικία δεν επηρεάζει εμφανώς το ποσό του δανείου, τουλάχιστον με γραμμικό τρόπο.

<br>
<br>

### Model 2 - Προσθήκη person_income

```{r}
model2 <- lm(person_age ~ loan_amnt + person_income , data = loandata)
summary(model2)
```

**Σχόλιο:**
Με την προσθήκη του person_income στο μοντέλο, παρατηρείται αξιοσημείωτη βελτίωση. Ο νέος συντελεστής για το person_income είναι στατιστικά σημαντικός (p-value < 2e-16) και έχει θετικό πρόσημο, υποδηλώνοντας ότι όσο αυξάνεται το εισόδημα, αυξάνεται και η ηλικία, κάτι που ίσως αντανακλά μια γενική τάση μεγαλύτερων ηλικιών να έχουν υψηλότερα εισοδήματα.
Αντίθετα, το loan_amnt πλέον δεν είναι στατιστικά σημαντικό (p-value = 0.395), πράγμα που σημαίνει ότι μόλις προστεθεί το εισόδημα στο μοντέλο, η επίδραση του ποσού του δανείου στην ηλικία σχεδόν εξαφανίζεται.
Η τιμή του R-squared αυξάνεται στο 0.0375, κάτι που δείχνει ότι το μοντέλο εξηγεί περίπου το 3.75% της διακύμανσης στην ηλικία — σαφώς βελτιωμένο σε σχέση με το προηγούμενο μοντέλο, αν και ακόμα σχετικά χαμηλό.
Συνοπτικά, η προσθήκη του εισοδήματος βελτιώνει το μοντέλο και αναδεικνύει ότι το εισόδημα σχετίζεται πολύ πιο έντονα με την ηλικία από ό,τι το ποσό του δανείου.

<br>
<br>

### Model 3 - Προσθήκη person_age

```{r}
model3 <- lm(person_age ~ loan_amnt + person_income + person_education, data = loandata)
summary(model3)
```

**Σχόλιο**
Η προσθήκη της μεταβλητής person_education στο μοντέλο έχει σημαντική επίδραση στην πρόβλεψη της ηλικίας. Στο προηγούμενο μοντέλο, όπου περιλαμβάνονταν μόνο οι μεταβλητές loan_amnt και person_income, το R-squared ήταν πολύ χαμηλό (0.0026), υποδεικνύοντας ότι το μοντέλο εξηγούσε μόνο το 0.26% της μεταβλητότητας στην ηλικία. Η προσθήκη του εισοδήματος αύξησε ελαφρώς την εξήγηση, αλλά παρέμεινε αρκετά περιορισμένη. Στο νέο μοντέλο, με την προσθήκη της μεταβλητής person_education, παρατηρείται μια σημαντική βελτίωση.
Η person_education έχει στατιστικά σημαντική επίδραση στην ηλικία, με διαφορετικές κατηγορίες εκπαίδευσης να συνδέονται με διαφορετικά επίπεδα ηλικίας. Τα άτομα με πτυχίο Bachelor εμφανίζονται κατά μέσο όρο νεότερα από τα άτομα στην αναφορά, ενώ τα άτομα με διδακτορικό τίτλο είναι κατά μέσο όρο μεγαλύτερα. Ενδιάμεσα, τα άτομα με απολυτήριο Λυκείου και με μεταπτυχιακό τίτλο έχουν επίσης διαφοροποιήσεις στην ηλικία τους σε σχέση με την αναφορά. Η σημασία της εκπαίδευσης στο μοντέλο ενισχύει τη ικανότητά του να εξηγεί την ηλικία, αλλά το R-squared παραμένει σχετικά χαμηλό (0.0533), υποδεικνύοντας ότι υπάρχουν άλλοι παράγοντες που επίσης επηρεάζουν την ηλικία και δεν καλύπτονται από το μοντέλο.
Συνολικά, η προσθήκη της εκπαίδευσης βελτιώνει την εξήγηση του μοντέλου και προσφέρει σημαντικές πληροφορίες για την ηλικία των ατόμων, αλλά το μοντέλο χρειάζεται περαιτέρω μεταβλητές ή πιο σύνθετους παράγοντες για να γίνει πιο ακριβές και να εξηγήσει καλύτερα την ηλικία των ατόμων.

<br>
<br>

```{r}
library(knitr)

model_summary <- data.frame(
  Μοντέλο = c(
    "Ηλικία ~ Ποσό Δανείου",
    "Ηλικία ~ Ποσό Δανείου + Εισόδημα",
    "Ηλικία ~ Ποσό Δανείου + Εισόδημα + Εκπαίδευση"
  ),
  R_squared = c(
    summary(model1)$r.squared,
    summary(model2)$r.squared,
    summary(model3)$r.squared
  ),
  SSE = c(
    deviance(model1),
    deviance(model2),
    deviance(model3)
  )
)

model_summary$R_squared <- round(model_summary$R_squared, 4)
model_summary$SSE <- round(model_summary$SSE, 2)

kable(model_summary, caption = "Σύγκριση Μοντέλων: R² και SSE")
```

<br>

## Συμπέρασμα
  Συνολικά, τα τρία μοντέλα παρέχουν μια αναλυτική εικόνα της σχέσης μεταξύ διαφόρων παραμέτρων και της ηλικίας των ατόμων, αλλά κάθε μοντέλο έχει τις δικές του αδυναμίες και πλεονεκτήματα.
Στο πρώτο μοντέλο, που περιλάμβανε μόνο το loan_amnt, το μοντέλο αποδείχθηκε πολύ περιορισμένο, καθώς η μεταβλητή αυτή εξηγούσε ελάχιστο ποσοστό της μεταβλητότητας στην ηλικία (μόλις 0.26% του R-squared). Παρά την στατιστική σημαντικότητα του ποσού του δανείου, η χαμηλή εξήγηση της ηλικίας υποδεικνύει ότι το ποσό του δανείου δεν είναι ουσιαστικός παράγοντας για την πρόβλεψη της ηλικίας.
Το δεύτερο μοντέλο, που προσέθεσε τη μεταβλητή person_income, παρουσίασε μια μικρή βελτίωση στην εξήγηση της ηλικίας (R-squared: 0.0533), με το εισόδημα να αποδεικνύεται σημαντικό παράγοντα για την ηλικία. Ωστόσο, το ποσό του δανείου παρέμεινε μη σημαντικό, υποδεικνύοντας ότι το εισόδημα είχε μεγαλύτερη επίδραση στην ηλικία.
Στο τρίτο μοντέλο, η προσθήκη της μεταβλητής person_education ενίσχυσε σημαντικά το μοντέλο, καθώς η εκπαίδευση των ατόμων αποδείχθηκε ισχυρός προγνωστικός παράγοντας για την ηλικία. Η εκπαίδευση φάνηκε να επηρεάζει την ηλικία, με άτομα με διδακτορικό τίτλο να είναι μεγαλύτερα και άτομα με πτυχίο Bachelor ή Master να είναι νεότερα, συγκριτικά με την αναφορά. Παρά τη βελτίωση, το R-squared παρέμεινε χαμηλό (0.0533), υποδεικνύοντας ότι το μοντέλο εξακολουθεί να μην εξηγεί μεγάλο μέρος της μεταβλητότητας στην ηλικία.
Σε τελική ανάλυση, ενώ η προσθήκη της person_education προσφέρει μια πιο ολοκληρωμένη εικόνα για την πρόβλεψη της ηλικίας, τα μοντέλα συνολικά υποδεικνύουν ότι υπάρχουν άλλοι παράγοντες που επηρεάζουν την ηλικία και δεν καλύπτονται πλήρως από τις μεταβλητές που εξετάστηκαν. Επομένως, παρά την πρόοδο που επιτεύχθηκε με την προσθήκη των νέων μεταβλητών, το μοντέλο εξακολουθεί να απαιτεί περαιτέρω βελτιώσεις και ίσως την προσθήκη περισσότερων παραμέτρων για να προσφέρει καλύτερη εξήγηση της ηλικίας των ατόμων.

<br>

## Διαχωρισμός training και testing sets

```{r}
library(caTools)

set.seed(903)

split <- sample.split(loandata, SplitRatio = 0.65)

train_set <- subset(loandata, split == TRUE)
test_set  <- subset(loandata, split == FALSE)

train <- subset(loandata, split == TRUE)
test  <- subset(loandata, split == FALSE)

# Εκτύπωση αριθμού καταχωρήσεων σε κάθε set
cat("Αριθμός καταχωρήσεων στο training set:", nrow(train), "\n")
cat("Αριθμός καταχωρήσεων στο testing set:", nrow(test), "\n")

```

```{r}
# 1. Φόρτωση βιβλιοθηκών
# Φόρτωση απαραίτητων βιβλιοθηκών
library(dplyr)


model <- glm(loan_status ~ ., data = train, family = binomial)


summary(model)

```
***Σχόλιο: ***
Το μοντέλο λογιστικής παλινδρόμησης δείχνει ότι μεταβλητές όπως το επιτόκιο δανείου, το ποσοστό εισοδήματος που αφιερώνεται στο δάνειο, το ποσό του δανείου, η πιστοληπτική ικανότητα και ο σκοπός του δανείου έχουν ισχυρή και στατιστικά σημαντική συσχέτιση με την πιθανότητα έγκρισης του δανείου (p < 0.05).

<br>

```{r}
ggplot(train, aes(x = person_income, y = loan_status, color = loan_intent)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "glm", method.args = list(family = "binomial"), se = FALSE) +
  labs(title = "Logistic Regression: Loan Status vs Income",
       x = "Annual Income",
       y = "Probability of Loan Default") +
  theme_minimal()

```

```{r full-model, message=FALSE, warning=FALSE}
full_model <- glm(Response ~ ., data = train_set, family = "binomial")
```

```{r}
predictTest <- predict(reduced_model, newdata = test_set, type = "response")
set.seed(123)
sample_indices <- sample(1:length(predictTest), 10)
predictTest[sample_indices]
```